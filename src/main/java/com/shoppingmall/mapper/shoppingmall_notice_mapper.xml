<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="mapper.notice">
	<!-- notice join-->
	<insert id="insert" parameterType="com.shoppingmall.vo.Myshop_noticeVO">
		insert into myshop_notice
			values('n_'||sequ_myshop_notice.nextval,#{ntitle}, #{ncontent}, #{ncode}, #{nfile}, #{nsfile}, #{ncrucial}, #{nsdate}, #{nedate})
	</insert>
	
	<!-- notice select_all-->
	<select id="select_all" resultType="com.shoppingmall.vo.Myshop_noticeVO">
		select rownum rno, nid, ntitle, ncrucial, nfile ,nsdate, nedate, ncode
				from(select nid, ntitle, ncrucial, nfile ,nsdate, nedate, ncode from myshop_notice)
	</select>
	
	<!-- notice total_count-->
	<select id="total_count" resultType="int">
		select count(*) from myshop_notice
	</select>
	
	<!-- notice delete-->
	<delete id="delete" parameterType="java.lang.String">
		delete from myshop_notice where nid = #{nid}
	</delete>
	
	<!-- notice select-->
	<select id="select" parameterType="java.lang.String" resultType="com.shoppingmall.vo.Myshop_noticeVO">
		select nid, ncode, ntitle, ncontent, ncrucial, nfile ,nsdate, nedate from myshop_notice where nid=#{nid}
	</select>
	<!-- notice update-->
	<update id="update" parameterType="com.shoppingmall.vo.Myshop_noticeVO">
		update myshop_notice set ncode=#{ncode}, ntitle=#{ntitle}, ncontent=#{ncontent}, nfile=#{nfile}, nsfile=#{nsfile} , ncrucial=#{ncrucial}, nsdate=#{nsdate}, nedate=#{nedate}
		 where nid=#{nid}
	</update>
	
	<!-- notice user_select_all-->
	<select id="user_select_all" parameterType="map" resultType="com.shoppingmall.vo.Myshop_noticeVO">
		select rno, nid, ntitle, ncrucial, nsdate, nedate, ncode
		from (select rownum rno, nid, ntitle, ncrucial, nsdate, nedate, ncode
				from(select nid, ntitle, ncrucial, nsdate, nedate, ncode from myshop_notice)
				where to_char(sysdate, 'yyyy-mm-dd')>=nsdate and nedate>=to_char(sysdate, 'yyyy-mm-dd')
				)
		where rno between #{start} and #{end}
	</select>
	
	<!-- notice search_select-->
	<select id="search_select" parameterType="map" resultType="com.shoppingmall.vo.Myshop_noticeVO">
		select rno, nid, ntitle, ncrucial, nsdate, nedate, ncode
		from (select rownum rno, nid, ntitle, ncrucial, nsdate, nedate, ncode
				from(select nid, ntitle, ncrucial, nsdate, nedate, ncode from myshop_notice where #{searchtype} like '%#{text}%')
				where to_char(sysdate, 'yyyy-mm-dd')>=nsdate and nedate>=to_char(sysdate, 'yyyy-mm-dd')
				)
		where rno between #{start} and #{end}
	</select>
</mapper>  